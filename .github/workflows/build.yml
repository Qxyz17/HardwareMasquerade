name: Build Hardware Masquerade

on:
  workflow_dispatch:
    inputs:
      build_type:
        description: 'Build Type'
        required: true
        default: 'release'
        type: choice
        options:
          - release
          - debug
      platform:
        description: 'Platform'
        required: true
        default: 'x64'
        type: choice
        options:
          - x64
          - x86

jobs:
  build:
    runs-on: windows-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      
      - name: Install Visual Studio Build Tools
        uses: microsoft/setup-msbuild@v2
      
      - name: Run CI build script (PowerShell)
        shell: pwsh
        run: |
          Write-Host "Running CI build script..." -ForegroundColor Green
          .\build-ci.ps1
      
      - name: Upload artifacts
        uses: actions/upload-artifact@v4
        with:
          name: HardwareMasquerade-CI-${{ github.run_number }}-${{ github.event.inputs.platform }}
          path: |
            output/
            dist/
          if-no-files-found: warn
          retention-days: 30